this is the complete implementation of Chandy-Lamport algorithm
(deadlock, data race checked)